import random
import re

class RuleBot:
    ## response
    negative_res = ("no","nope","nah","not this time","better luck next time")
    exit_commands = ("quit","pause","exit","goodbye","saayonara","accha kbhi milte h")
    
    random_questions = (
        "ğŸ• Whatâ€™s your all-time favorite comfort food? ",
        "ğŸ¥— Do you prefer sweet or savory snacks? ",
        "ğŸ« If you could only eat one dessert for the rest of your life, what would it be? ",
        "ğŸ” Whatâ€™s the weirdest food combination youâ€™ve ever tried? ",
        "ğŸŒ® If you had to pick: pizza or burgers? ",
        "ğŸ£ Do you like trying new cuisines or stick to familiar foods? ",
        "ğŸ¥¤ Whatâ€™s your go-to drink when eating out? ",
        "ğŸœ If you were a chef for one day, what dish would you cook? ",
        "ğŸ Do you prefer fruits or vegetables? ",
        "ğŸ© Midnight snack: sweet or salty? "
    )
    
    # sample Italian menu
    menu = {
        "margherita pizza": 300,
        "pasta alfredo": 400,
        "spaghetti aglio e olio": 250,
        "lasagna": 500,
        "tiramisu": 200,
        "gelato": 150
    }
    
    def __init__(self):
        self.order = []   # store items user orders
        self.foodbabble = {
            'describe_food_interest': r'.*\s*your food.*',
            'answer_why_tasty': r'.*coz of taste.*',
            'about_price': r'.*\s*price.*',
            'order_food': r'.*(order|buy|eat|want).*'
        }
    
    def greet(self):
        self.name = input("What is your name?\n")
        self.age = input("What is your age?\n")
        will_help = input(
            f"Hi {self.name}, I am Jarvis. I can help you decide and even order your food. Shall we continue?\n"
        ).lower()
        
        if will_help in self.negative_res:
            print("May you find something tasty outside in another store.")
            return 
        self.chat()
        
    def make_exit(self, reply):
        for command in self.exit_commands:
            if reply.strip() == command:
                print("Thank you for visiting! ğŸ‘‹")
                return True
        return False

    def chat(self):
        reply = input(random.choice(self.random_questions)).lower()
        while not self.make_exit(reply):
            reply = input(self.match_reply(reply)).lower()
    
    def match_reply(self, reply):
        for intent, regex_pattern in self.foodbabble.items():
            if re.match(regex_pattern, reply):
                if intent == 'describe_food_interest':
                    return self.describe_food_interest()
                elif intent == 'answer_why_tasty':
                    return self.answer_why_tasty()
                elif intent == 'about_price':
                    return self.about_price()
                elif intent == 'order_food':
                    return self.order_food()
        return self.no_match_intent()
    
    def describe_food_interest(self):
        responses = (
            "My cafe name is Alfredo Bin Ulli. ğŸ´\n",
            "Here coffee is good, and we serve only Italian food that is worth the price. ğŸ‡®ğŸ‡¹\n"
        )
        return random.choice(responses)
    
    def answer_why_tasty(self):
        responses = (
            "Because nothing beats the taste of fresh Italian pasta ğŸ\n",
            "Itâ€™s all about the perfect blend of herbs and olive oil ğŸŒ¿\n",
            "Cheese, tomatoes, and a crispy crust â€” thatâ€™s the magic of pizza ğŸ•\n",
            "The taste comes from generations of Italian tradition ğŸ‡®ğŸ‡¹\n",
            "Fresh ingredients make every bite unforgettable ğŸ§„ğŸ…\n"
        )
        return random.choice(responses)
    
    def about_price(self):
        responses = (
            "A classic Margherita pizza usually costs around â‚¹250â€“â‚¹400 ğŸ•\n",
            "Fresh pasta dishes in restaurants are often priced between â‚¹300â€“â‚¹500 ğŸ\n",
            "Italian gelato is surprisingly affordable â€” usually â‚¹100â€“â‚¹200 per scoop ğŸ¨\n",
            "A simple plate of spaghetti aglio e olio can be found for just â‚¹150â€“â‚¹250 ğŸ…ğŸ§„\n",
            "Even fine-dining Italian meals usually range from â‚¹600â€“â‚¹1200 ğŸ½ï¸\n"
        )
        return random.choice(responses)
    
    def order_food(self):
        print("\nHereâ€™s our Italian Menu: ğŸ½ï¸")
        for item, price in self.menu.items():
            print(f"- {item.title()} : â‚¹{price}")
        
        choice = input("\nWhat would you like to order? (type item name)\n").lower()
        
        if choice in self.menu:
            self.order.append((choice, self.menu[choice]))
            more = input(f"{choice.title()} added! Would you like to order more? (yes/no)\n").lower()
            if more == "yes":
                return self.order_food()
            else:
                return self.final_bill()
        else:
            return "Sorry, we donâ€™t have that item. Please choose from the menu.\n"
    
    def final_bill(self):
        print("\nYour Order Summary ğŸ§¾:")
        subtotal = 0
        for item, price in self.order:
            print(f"- {item.title()} : â‚¹{price}")
            subtotal += price
        
        tax = subtotal * 0.10   # 10% GST
        gross_total = subtotal + tax
        
        print(f"\nSubtotal: â‚¹{subtotal}")
        print(f"Tax (10%): â‚¹{tax:.2f}")
        print(f"ğŸ‘‰ Gross Bill: â‚¹{gross_total:.2f}")
        
        return "Would you like to confirm your order? (yes/no)\n"
    
    def no_match_intent(self):
        responses = (
            "Please tell me more.\n",
            "Tell me more! ğŸ¤”\n",
            "I see. Can you elaborate?\n",
            "Interestingâ€¦ can you tell me more?\n",
            "I see. How do you think?\n",
            "Why?\n",
            "How do you think I feel when I say that? Why?\n"
        )
        return random.choice(responses)


# Run the bot
bot = RuleBot()
bot.greet()
